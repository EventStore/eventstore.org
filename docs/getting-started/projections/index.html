<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="preconnect" href="//eventstore.org">
    <link rel="preconnect" href="//fonts.googleapis.com">
    <link rel="preconnect" href="//code.jquery.com">
    <link rel="preconnect" href="//www.googletagmanager.com">
    <title>Step 3 - Projections | Event Store </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Step 3 - Projections | Event Store ">
    <meta name="generator" content="docfx 2.47.0.0">
  <meta http-equiv="Content-Type" content="text/html charset=UTF-8">
    
    <link rel="shortcut icon" href="../../assets/favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
      <link rel="stylesheet" href="../../styles/main12.css">
        <link rel="stylesheet" href="../../styles/print.css" media="print">
              <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,400italic,500,500italic,700,700italic|Source+Code+Pro:400,700">
              <style media="print">
                  pre {
                      white-space: pre-wrap;
                  }
                  .site-navigation-toggle, .docs-toc-toggle, .footer__menu {
                      display: none;
                  }
                  p, ul, ol {
                      max-width: 100% !important;
                  }
                  .version-dropdown__selected {
  
                  }
                  .version-dropdown__options {
  
                  }
              </style>
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <script src="https://secure.perk0mean.com/js/168910.js"></script>
    <noscript><img alt="" src="https://secure.perk0mean.com/168910.png" style="display:none;"></noscript>
    <div id="wrapper">
      <header class="site-banner" role="banner">
        <div class="inner-container">
            <h1 class="site-logo">
                <a href="/">
                    <img src="../../logo.svg" alt="Event Store logo">
                </a>
            </h1>
            <ul class="site-navigation">
                <li class="site-navigation__item"><a href="/support">Support</a></li>
                <li class="site-navigation__item"><a href="https://training.eventstore.com">Training</a></li>
                <li class="site-navigation__item"><a href="/docs">Docs</a></li>
                <li class="site-navigation__item"><a href="/downloads">Downloads</a></li>
                <li class="site-navigation__item"><a href="/community">Community</a></li>
                <li class="site-navigation__item"><a href="/blog">Blog</a></li>
                <li class="site-navigation__item"><a href="/contact">Contact</a></li>
            </ul>
            <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                    <input type="text" class="form-control" id="search-query" placeholder="Search the docs" autocomplete="off">
                </div>
            </form>
            <a href="javascript:void(0)" class="site-navigation-toggle">Menu</a>
        </div>      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <!--  TODO: Currently override (git history) shouldn't need to.-->
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="step-3---projections">Step 3 - Projections</h1>

<p>This getting started guide shows you how to get started with Event Store using the Atom publishing protocol as the primary interface. </p>
<div class="NOTE"><h5>Note</h5><p>The described is for development and evaluation of Event Store. It does not describe a production setup. The HTTP examples use cURL, but you can read Atom feeds with a wide variety of applications and languages.</p>
</div>
<p>Projections is an Event Store subsystem that lets you write new events or link existing events to streams in a reactive manner.</p>
<p>Projections are good at solving one specific query type, a category known as &#39;temporal correlation queries&#39;. This query type is common in business systems and few can execute these queries well.</p>
<div class="NOTE"><h5>Note</h5><p>Projections require the event body to be in JSON.</p>
</div>
<p>When running a projection, you can choose whether the query should run and give you all results present or whether the query should continue running into the future finding new results as they happen and updating its result set.</p>
<h2 id="setting-up-projections">Setting up projections</h2>
<p>You enable projections with the command line argument <code>--run-projections</code>. For example, the command below enables all projection modes (system and user-defined):</p>
<div class="TIP"><h5>Tip</h5><p><a href="../../server/command-line-arguments/index.html#projections-options">Read this guide</a> for all the possible parameter values.</p>
</div>
<div class="tabGroup" id="tabgroup_-zRZHSVchy">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy_tabid-1" role="tab" aria-controls="tabpanel_-zRZHSVchy_tabid-1" data-tab="tabid-1" tabindex="0" aria-selected="true">Windows</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy_tabid-2" role="tab" aria-controls="tabpanel_-zRZHSVchy_tabid-2" data-tab="tabid-2" tabindex="-1">Linux</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy_tabid-3" role="tab" aria-controls="tabpanel_-zRZHSVchy_tabid-3" data-tab="tabid-3" tabindex="-1">Docker</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy_tabid-macos" role="tab" aria-controls="tabpanel_-zRZHSVchy_tabid-macos" data-tab="tabid-macos" tabindex="-1">macOS</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy_tabid-1" role="tabpanel" data-tab="tabid-1">
<pre><code class="lang-powershell">EventStore.ClusterNode.exe --run-projections=all --start-standard-projections=true
</code></pre><p>To disable them again, run:</p>
<pre><code class="lang-powershell">EventStore.ClusterNode.exe --run-projections=none
</code></pre></section>
<section id="tabpanel_-zRZHSVchy_tabid-2" role="tabpanel" data-tab="tabid-2" aria-hidden="true" hidden="hidden">
<p>Add <code>EVENTSTORE_RUN_PROJECTIONS=All</code> and <code>EVENTSTORE_START_STANDARD_PROJECTIONS=true</code> to your environment variables, or the <em>/etc/eventstore/eventstore.conf</em> configuration file and start Event Store:</p>
<pre><code class="lang-bash">sudo systemctl start eventstore
</code></pre><p>To disable them again, change the values to <code>EVENTSTORE_RUN_PROJECTIONS=none</code>.</p>
</section>
<section id="tabpanel_-zRZHSVchy_tabid-3" role="tabpanel" data-tab="tabid-3" aria-hidden="true" hidden="hidden">
<p>The Event Store Docker image has projections enabled by default, but you need to enable standard projections:</p>
<pre><code class="lang-bash">docker run --name eventstore-node -it -p 2113:2113 -p 1113:1113 -e EVENTSTORE_RUN_PROJECTIONS=All -e EVENTSTORE_START_STANDARD_PROJECTIONS=true eventstore/eventstore
</code></pre><p>To disable them again:</p>
<pre><code class="lang-bash">docker run --name eventstore-node -it -p 2113:2113 -p 1113:1113 -e EVENTSTORE_RUN_PROJECTIONS=None eventstore/eventstore
</code></pre></section>
<section id="tabpanel_-zRZHSVchy_tabid-macos" role="tabpanel" data-tab="tabid-macos" aria-hidden="true" hidden="hidden">
<pre><code class="lang-bash">eventstore --run-projections=all --start-standard-projections=true
</code></pre><p>To disable them again, run:</p>
<pre><code class="lang-bash">eventstore --run-projections=none
</code></pre><div class="NOTE"><h5>Note</h5><p>To use the default database location on macOS you need to use <code>sudo</code>, or you can change the location with the <code>--db</code> parameter.</p>
</div>
</section>
</div>
<p>You then see new tabs enabled in the Admin UI with the four system projections in a <code>Stopped</code> state:</p>
<p><img src="../../images/projections-menu-item.png" alt="Projections tab"></p>
<p><img src="../../images/projections-default.png" alt="Projections default state"></p>
<p>You can also query the state of all projections using the HTTP API.</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-1_tabid-4" role="tab" aria-controls="tabpanel_-zRZHSVchy-1_tabid-4" data-tab="tabid-4" tabindex="0" aria-selected="true">Request</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-1_tabid-5" role="tab" aria-controls="tabpanel_-zRZHSVchy-1_tabid-5" data-tab="tabid-5" tabindex="-1">Response</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-1_tabid-4" role="tabpanel" data-tab="tabid-4">
<pre><code class="lang-bash" name="getting-started-projections-get-all-request">curl -i http://localhost:2113/projections/any -H &quot;accept:application/json&quot; | grep -E &#39;effectiveName|status&#39;
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-1_tabid-5" role="tabpanel" data-tab="tabid-5" aria-hidden="true" hidden="hidden">
<p>The response is a list of all known projections and useful information about them.</p>
<pre><code class="lang-json" name="getting-started-projections-get-all-response">&quot;effectiveName&quot;: &quot;$streams&quot;
&quot;status&quot;: &quot;Stopped&quot;
&quot;statusUrl&quot;: &quot;http://localhost:2113/projection/$streams&quot;

&quot;effectiveName&quot;: &quot;$stream_by_category&quot;
&quot;status&quot;: &quot;Stopped&quot;
&quot;statusUrl&quot;: &quot;http://localhost:2113/projection/$stream_by_category&quot;

&quot;effectiveName&quot;: &quot;$by_category&quot;
&quot;status&quot;: &quot;Stopped&quot;
&quot;statusUrl&quot;: &quot;http://localhost:2113/projection/$by_category&quot;

&quot;effectiveName&quot;: &quot;$by_event_type&quot;
&quot;status&quot;: &quot;Stopped&quot;
&quot;statusUrl&quot;: &quot;http://localhost:2113/projection/$by_event_type&quot;
</code></pre></section>
</div>
<h2 id="add-sample-data">Add sample data</h2>
<p>Download the following files that contain sample data used throughout this step of the getting started guide.</p>
<ul>
<li><a href="../../code-examples/getting-started/shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1164.json">shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1164.json</a></li>
<li><a href="../../code-examples/getting-started/shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1165.json">shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1165.json</a></li>
<li><a href="../../code-examples/getting-started/shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1166.json">shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1166.json</a></li>
<li><a href="../../code-examples/getting-started/shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1167.json">shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1167.json</a></li>
</ul>
<p>Add the sample data to four different streams:</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-2_tabid-http-api" role="tab" aria-controls="tabpanel_-zRZHSVchy-2_tabid-http-api" data-tab="tabid-http-api" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-2_tabid-net-api" role="tab" aria-controls="tabpanel_-zRZHSVchy-2_tabid-net-api" data-tab="tabid-net-api" tabindex="-1">.NET API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-2_tabid-jvm-api" role="tab" aria-controls="tabpanel_-zRZHSVchy-2_tabid-jvm-api" data-tab="tabid-jvm-api" tabindex="-1">JVM client</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-2_tabid-http-api" role="tabpanel" data-tab="tabid-http-api">
<pre><code class="lang-bash" name="getting-started-projections-add-sample-data">curl -i -d &quot;@shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1164.json&quot; &quot;http://127.0.0.1:2113/streams/shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1164&quot; -H &quot;Content-Type:application/vnd.eventstore.events+json&quot;

curl -i -d &quot;@shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1165.json&quot; &quot;http://127.0.0.1:2113/streams/shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1165&quot; -H &quot;Content-Type:application/vnd.eventstore.events+json&quot;

curl -i -d &quot;@shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1166.json&quot; &quot;http://127.0.0.1:2113/streams/shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1166&quot; -H &quot;Content-Type:application/vnd.eventstore.events+json&quot;

curl -i -d &quot;@shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1167.json&quot; &quot;http://127.0.0.1:2113/streams/shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1167&quot; -H &quot;Content-Type:application/vnd.eventstore.events+json&quot;
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-2_tabid-net-api" role="tabpanel" data-tab="tabid-net-api" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-add-sample-data">foreach (string f in Directory.GetFiles(&quot;../&quot;, &quot;shoppingCart-*&quot;))
{
    var streamName = Path.GetFileNameWithoutExtension(f);
    conn.AppendToStreamAsync(streamName, ExpectedVersion.Any, eventData).Wait();
}
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-2_tabid-jvm-api" role="tabpanel" data-tab="tabid-jvm-api" aria-hidden="true" hidden="hidden">
<pre><code class="lang-java" name="getting-started-write-multiple">final Collection fileList = getAllFilesThatMatchFilenameExtension(&quot;/Users/chrisward/Workspace/EventStore/docs.geteventstore.com/code-examples/getting-started&quot;, &quot;shoppingCart-*&quot;);

for (Object file : fileList) {
    String streamName = FilenameUtils.getBaseName(removeExtension(file.toString()));
    System.out.println(&quot;value= &quot; + streamName);

    JSONParser parser = new JSONParser();
    try {
        JSONArray events = (JSONArray) parser.parse(new FileReader(file.toString()));

        for (Object e : events) {
            JSONObject event = (JSONObject) e;

            final EventData json = new EventDataBuilder(&quot;json&quot;)
                    .eventId(UUID.fromString((String) event.get(&quot;eventId&quot;)))
                    .jsonData((event.get(&quot;data&quot;)).toString())
                    .jsonMetadata(event.get(&quot;metadata&quot;).toString())
                    .build();

            final WriteEvents writeEvents = new WriteEventsBuilder(&quot;newstream&quot;)
                    .addEvent(json)
                    .expectAnyVersion()
                    .build();

            connection.tell(writeEvents, writeResult);
        }
    } catch (FileNotFoundException e) {
        e.printStackTrace();
    } catch (IOException e) {
        e.printStackTrace();
    } catch (ParseException e) {
        e.printStackTrace();
    }
}
</code></pre></section>
</div>
<div class="NOTE"><h5>Note</h5><p>While it&#39;s not the fastest method, you can also use the Admin UI for creating the streams, and all the tasks in this step, as we saw in <a href="../index.html">step 1</a>.</p>
</div>
<h2 id="writing-your-first-projection">Writing your first projection</h2>
<div class="TIP"><h5>Tip</h5><p>Read <a href="../../projections/user-defined-projections/index.html">this guide</a> to find out more about the user defined projection&#39;s API.</p>
</div>
<p>The projection counts the number of &#39;XBox One S&#39;s that customers added to their shopping carts.</p>
<p>A projection starts with a selector, in this case <code>fromAll()</code>. Another possibility is <code>fromCategory({category})</code> which this step discusses later, but for now, <code>fromAll</code> should do.</p>
<p>The second part of a projection is a set of filters. There is a special filter called <code>$init</code> that sets up an initial state. You want to start a counter from 0 and each time Event Store observes an <code>ItemAdded</code> event for an &#39;Xbox One S,&#39; increment the counter.</p>
<p>Here is the projection, you can download it as a file <a href="../../code-examples/getting-started/xbox-one-s-counter.json">here</a>:</p>
<pre><code class="lang-json" name="getting-started-projections-projection">fromAll()
.when({
    $init: function(){
        return {
            count: 0
        }
    },
    ItemAdded: function(s,e){
        if(e.body.Description.indexOf(&quot;Xbox One S&quot;) &gt;= 0){
            s.count += 1;
        }
    }
})
</code></pre><p>You create a projection by calling the projection API and providing it with the definition of the projection. Here you decide how to run the projection, declaring that you want the projection to start from the beginning and keep running. You can create a projection using the Admin UI by opening the <em>Projections</em> tab, clicking the <em>New Projection</em> button and filling in the details of your projection.</p>
<p><img src="../../assets/getting-started-create-projection.png" alt="Creating a projection with the Event Store Admin UI"></p>
<p>To use the HTTP or .NET API, pass the projection JSON file as a parameter of your request, along with any other settings:</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-3">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-3_tabid-create-proj-bash" role="tab" aria-controls="tabpanel_-zRZHSVchy-3_tabid-create-proj-bash" data-tab="tabid-create-proj-bash" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-3_tabid-create-proj-net" role="tab" aria-controls="tabpanel_-zRZHSVchy-3_tabid-create-proj-net" data-tab="tabid-create-proj-net" tabindex="-1">.NET API</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-3_tabid-create-proj-bash" role="tabpanel" data-tab="tabid-create-proj-bash">
<pre><code class="lang-bash" name="getting-started-projections-create-projection">curl -i --data-binary &quot;@xbox-one-s-counter.json&quot; http://localhost:2113/projections/continuous?name=xbox-one-s-counter%26type=js%26enabled=true%26emit=true%26trackemittedstreams=true -u admin:changeit
</code></pre><div class="NEXT"><h5>Next Steps</h5><p><a href="../../projections/api/index.html">Read here</a> for more information on creating projections with the HTTP API and the parameters available, or <a href="../../projections/index.html">our projections section</a> for details on projection syntax.</p>
</div>
</section>
<section id="tabpanel_-zRZHSVchy-3_tabid-create-proj-net" role="tabpanel" data-tab="tabid-create-proj-net" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-create-projection-dotnet">public static readonly ProjectionsManager Projection = new ProjectionsManager(new ConsoleLogger(),
    new IPEndPoint(IPAddress.Parse(&quot;127.0.0.1&quot;), 2113), TimeSpan.FromMilliseconds(5000));
projection.CreateContinuousAsync(&quot;xbox-one-s-counter&quot;, countItemsProjection, adminCredentials).Wait();
</code></pre><div class="NEXT"><h5>Next Steps</h5><p><a href="../../dotnet-api/projections/index.html">Read here</a> for more information on creating projections with the .NET API and the parameters available, or <a href="../../projections/index.html">our projections section</a> for details on projection syntax.</p>
</div>
</section>
</div>
<h2 id="querying-for-the-state-of-the-projection">Querying for the state of the projection</h2>
<p>Now the projection is running, you can query the state of the projection. As this projection has a single state, query it with the following request:</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-4">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-4_tabid-8" role="tab" aria-controls="tabpanel_-zRZHSVchy-4_tabid-8" data-tab="tabid-8" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-4_tabid-get-state-dotnet" role="tab" aria-controls="tabpanel_-zRZHSVchy-4_tabid-get-state-dotnet" data-tab="tabid-get-state-dotnet" tabindex="-1">.NET API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-4_tabid-9" role="tab" aria-controls="tabpanel_-zRZHSVchy-4_tabid-9" data-tab="tabid-9" tabindex="-1">Response</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-4_tabid-8" role="tabpanel" data-tab="tabid-8">
<pre><code class="lang-bash" name="getting-started-projections-query-state-request">curl -i http://localhost:2113/projection/xbox-one-s-counter/state
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-4_tabid-get-state-dotnet" role="tabpanel" data-tab="tabid-get-state-dotnet" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-add-sample-data">var projectionState = projection.GetStateAsync(&quot;xbox-one-s-counter&quot;, Globals.AdminCredentials);
Console.WriteLine(projectionState.Result);
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-4_tabid-9" role="tabpanel" data-tab="tabid-9" aria-hidden="true" hidden="hidden">
<pre><code class="lang-json" name="getting-started-projections-query-state-response">{
    &quot;count&quot;: 3
}
</code></pre></section>
</div>
<h2 id="writing-to-streams-from-projections">Writing to streams from projections</h2>
<p>The above gives you the correct result but requires you to poll for the state of a projection. What if you wanted Event Store to notify you about state updates via subscriptions?</p>
<h3 id="output-state">Output state</h3>
<p>Update the projection to output the state to a stream by calling the <code>outputState()</code> method on the projection which by default produces a <code>$projections-{projection-name}-result</code> stream.</p>
<p>Below is the updated projection, you can download it as a file <a href="../../code-examples/getting-started/xbox-one-s-counter-outputState.json">here</a>:</p>
<pre><code class="lang-json" name="getting-started-projections-output-state">fromAll()
.when({
    $init: function(){
        return {
            count: 0
        }
    },
    ItemAdded: function(s,e){
        if(e.body.Description.indexOf(&quot;Xbox One S&quot;) &gt;= 0){
            s.count += 1;
        }
    }
}).outputState()
</code></pre><p>To update the projection, edit the projection definition in the Admin UI, or issue the following request:</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-5">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-5_tabid-update-proj-http" role="tab" aria-controls="tabpanel_-zRZHSVchy-5_tabid-update-proj-http" data-tab="tabid-update-proj-http" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-5_tabid-update-proj-dotnet" role="tab" aria-controls="tabpanel_-zRZHSVchy-5_tabid-update-proj-dotnet" data-tab="tabid-update-proj-dotnet" tabindex="-1">.NET API</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-5_tabid-update-proj-http" role="tabpanel" data-tab="tabid-update-proj-http">
<pre><code class="lang-bash" name="getting-started-projections-output-state-update">curl -i -X PUT --data-binary @&quot;xbox-one-s-counter-outputState.json&quot; http://localhost:2113/projection/xbox-one-s-counter/query?emit=yes -u admin:changeit
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-5_tabid-update-proj-dotnet" role="tabpanel" data-tab="tabid-update-proj-dotnet" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-update">projection.UpdateQueryAsync(&quot;xbox-one-s-counter&quot;, countItemsProjectionUpdate, adminCredentials).Wait();
</code></pre></section>
</div>
<p>Then reset the projection you created above:</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-6">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-6_tabid-reset-http" role="tab" aria-controls="tabpanel_-zRZHSVchy-6_tabid-reset-http" data-tab="tabid-reset-http" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-6_tabid-reset-dotnet" role="tab" aria-controls="tabpanel_-zRZHSVchy-6_tabid-reset-dotnet" data-tab="tabid-reset-dotnet" tabindex="-1">.NET API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-6_tabid-11" role="tab" aria-controls="tabpanel_-zRZHSVchy-6_tabid-11" data-tab="tabid-11" tabindex="-1">Response</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-6_tabid-reset-http" role="tabpanel" data-tab="tabid-reset-http">
<pre><code class="lang-bash" name="getting-started-projections-reset-request">curl -i -X POST &quot;http://localhost:2113/projection/xbox-one-s-counter/command/reset&quot; -H &quot;accept:application/json&quot; -H &quot;Content-Length:0&quot; -u admin:changeit
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-6_tabid-reset-dotnet" role="tabpanel" data-tab="tabid-reset-dotnet" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-reset">projection.ResetAsync(&quot;xbox-one-s-counter&quot;, adminCredentials).Wait();
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-6_tabid-11" role="tabpanel" data-tab="tabid-11" aria-hidden="true" hidden="hidden">
<pre><code class="lang-json" name="getting-started-projections-reset-response">{
    &quot;msgTypeId&quot;: 293,
    &quot;name&quot;: &quot;xbox-one-s-counter&quot;
}
</code></pre></section>
</div>
<p>You can now read the events in the result stream by issuing a read request.</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-7">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-7_tabid-read-stream-http" role="tab" aria-controls="tabpanel_-zRZHSVchy-7_tabid-read-stream-http" data-tab="tabid-read-stream-http" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-7_tabid-read-stream-dotnet" role="tab" aria-controls="tabpanel_-zRZHSVchy-7_tabid-read-stream-dotnet" data-tab="tabid-read-stream-dotnet" tabindex="-1">.NET API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-7_tabid-13" role="tab" aria-controls="tabpanel_-zRZHSVchy-7_tabid-13" data-tab="tabid-13" tabindex="-1">Response</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-7_tabid-read-stream-http" role="tabpanel" data-tab="tabid-read-stream-http">
<pre><code class="lang-bash" name="getting-started-projections-read-projection-events-request">curl -i &quot;http://localhost:2113/streams/\$projections-xbox-one-s-counter-result?embed=body&quot; -H &quot;accept:application/json&quot; -u admin:changeit | grep data
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-7_tabid-read-stream-dotnet" role="tabpanel" data-tab="tabid-read-stream-dotnet" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-state">var readEvents = conn.ReadStreamEventsForwardAsync(&quot;$projections-xbox-one-s-counter-result&quot;, 0, 10, true)
    .Result;
foreach (var evt in readEvents.Events)
    Console.WriteLine(Encoding.UTF8.GetString(evt.Event.Data));
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-7_tabid-13" role="tabpanel" data-tab="tabid-13" aria-hidden="true" hidden="hidden">
<pre><code class="lang-json" name="getting-started-projections-read-projection-events-response">&quot;data&quot;: &quot;{\&quot;count\&quot;:3}&quot;,
&quot;data&quot;: &quot;{\&quot;count\&quot;:2}&quot;,
&quot;data&quot;: &quot;{\&quot;count\&quot;:1}&quot;,
</code></pre></section>
</div>
<h2 id="configure-projection-properties">Configure projection properties</h2>
<p>You can configure properties of the projection by updating values of the <code>options</code> object. For example, the following projection changes the name of the results stream, you can download it as a file <a href="../../code-examples/getting-started/update-projection-options.json">here</a>:</p>
<pre><code class="lang-json" name="getting-started-projections-update-options" highlight-lines="2">options({
  resultStreamName: &quot;xboxes&quot;
})
fromAll()
.when({
    $init: function(){
        return {
            count: 0
        }
    },
    ItemAdded: function(s,e){
        if(e.body.Description.indexOf(&quot;Xbox One S&quot;) &gt;= 0){
            s.count += 1;
        }
    }
}).outputState()
</code></pre><p>Then send the update to the projection:</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-8">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-8_tabid-update-proj-config-http" role="tab" aria-controls="tabpanel_-zRZHSVchy-8_tabid-update-proj-config-http" data-tab="tabid-update-proj-config-http" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-8_tabid-update-proj-config-dotnet" role="tab" aria-controls="tabpanel_-zRZHSVchy-8_tabid-update-proj-config-dotnet" data-tab="tabid-update-proj-config-dotnet" tabindex="-1">.NET API</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-8_tabid-update-proj-config-http" role="tabpanel" data-tab="tabid-update-proj-config-http">
<pre><code class="lang-bash" name="getting-started-projections-config-update-request">curl -i -X PUT -d &quot;@update-projection-options.json&quot; http://localhost:2113/projection/xbox-one-s-counter/query?emit=yes -u admin:changeit
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-8_tabid-update-proj-config-dotnet" role="tabpanel" data-tab="tabid-update-proj-config-dotnet" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-config-update">projection.UpdateQueryAsync(&quot;xbox-one-s-counter&quot;, optionsProjectionOptionsUpdate,adminCredentials).Wait();
</code></pre></section>
</div>
<div class="TIP"><h5>Tip</h5><p>You can find all the options available in the <a href="../../projections/user-defined-projections/index.html">user defined projections guide</a>.</p>
</div>
<p>Now you can read the result as above, but use the new stream name:</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-9">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-9_tabid-read-projection-events-renamed-http" role="tab" aria-controls="tabpanel_-zRZHSVchy-9_tabid-read-projection-events-renamed-http" data-tab="tabid-read-projection-events-renamed-http" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-9_tabid-read-projection-events-renamed-dotnet" role="tab" aria-controls="tabpanel_-zRZHSVchy-9_tabid-read-projection-events-renamed-dotnet" data-tab="tabid-read-projection-events-renamed-dotnet" tabindex="-1">.NET API</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-9_tabid-read-projection-events-renamed-http" role="tabpanel" data-tab="tabid-read-projection-events-renamed-http">
<pre><code class="lang-bash" name="getting-started-projections-read-projection-events-renamed-request">curl -i &quot;http://localhost:2113/streams/xboxes?embed=body&quot; -H &quot;accept:application/json&quot; -u admin:changeit | grep data
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-9_tabid-read-projection-events-renamed-dotnet" role="tabpanel" data-tab="tabid-read-projection-events-renamed-dotnet" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-state">    readEvents = conn.ReadStreamEventsForwardAsync(&quot;xboxes&quot;, 0, 10, true).Result;
    foreach (var evt in readEvents.Events)
        Console.WriteLine(Encoding.UTF8.GetString(evt.Event.Data));
}
</code></pre></section>
</div>
<h2 id="the-number-of-items-per-shopping-cart">The number of items per shopping cart</h2>
<p>The example in this step so far relied on a global state for the projection, but what if you wanted a count of the number of items in the shopping cart per shopping cart.</p>
<p>Event Store has a built-in <code>$by_category</code> projection that lets you select events from a particular list of streams. Enable this projection with the following command.</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-10">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-10_tabid-enablebycategory-http" role="tab" aria-controls="tabpanel_-zRZHSVchy-10_tabid-enablebycategory-http" data-tab="tabid-enablebycategory-http" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-10_tabid-enablebycategory-dotnet" role="tab" aria-controls="tabpanel_-zRZHSVchy-10_tabid-enablebycategory-dotnet" data-tab="tabid-enablebycategory-dotnet" tabindex="-1">.NET API</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-10_tabid-enablebycategory-http" role="tabpanel" data-tab="tabid-enablebycategory-http">
<pre><code class="lang-bash" name="getting-started-projections-enable-by-category-request">curl -i -d{} http://localhost:2113/projection/%24by_category/command/enable -u admin:changeit
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-10_tabid-enablebycategory-dotnet" role="tabpanel" data-tab="tabid-enablebycategory-dotnet" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-enable">projection.EnableAsync(&quot;$by_category&quot;, adminCredentials).Wait();
</code></pre></section>
</div>
<p>The projection links events from existing streams to new streams by splitting the stream name by a separator. You can configure the projection to specify the position of where to split the stream <code>id</code> and provide a separator.</p>
<p>By default, the category splits the stream <code>id</code> by a dash. The category is the first string.</p>
<table>
<thead>
<tr>
<th>Stream Name</th>
<th>Category</th>
</tr>
</thead>
<tbody>
<tr>
<td>shoppingCart-54</td>
<td>shoppingCart</td>
</tr>
<tr>
<td>shoppingCart-v1-54</td>
<td>shoppingCart</td>
</tr>
<tr>
<td>shoppingCart</td>
<td><em>No category as there is no separator</em></td>
</tr>
</tbody>
</table>
<p>You want to define a projection that produces a count per stream for a category, but the state needs to be per stream. To do so, use <code>$by_category</code> and its <code>fromCategory</code> API method.</p>
<p>Below is the projection, you can download the file <a href="../../code-examples/getting-started/shopping-cart-counter.json">here</a>:</p>
<pre><code class="lang-json" name="getting-started-projections-count-per-stream">fromCategory(&#39;shoppingCart&#39;)
.foreachStream()
.when({
    $init: function(){
        return {
            count: 0
        }
    },
    ItemAdded: function(s,e){
        s.count += 1;
    }
})
</code></pre><p>Create the projection with the following request:</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-11">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-11_tabid-projections-count-per-stream-http" role="tab" aria-controls="tabpanel_-zRZHSVchy-11_tabid-projections-count-per-stream-http" data-tab="tabid-projections-count-per-stream-http" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-11_tabid-projections-count-per-stream-dotnet" role="tab" aria-controls="tabpanel_-zRZHSVchy-11_tabid-projections-count-per-stream-dotnet" data-tab="tabid-projections-count-per-stream-dotnet" tabindex="-1">.NET API</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-11_tabid-projections-count-per-stream-http" role="tabpanel" data-tab="tabid-projections-count-per-stream-http">
<pre><code class="lang-bash" name="getting-started-projections-count-per-stream">curl -i --data-binary &quot;@shopping-cart-counter.json&quot; http://localhost:2113/projections/continuous?name=shopping-cart-item-counter%26type=js%26enabled=true%26emit=true%26trackemittedstreams=true -u admin:changeit
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-11_tabid-projections-count-per-stream-dotnet" role="tabpanel" data-tab="tabid-projections-count-per-stream-dotnet" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-count-per-stream">projection.CreateContinuousAsync(&quot;shopping-cart-item-counter&quot;, itemCounterProjection, true, adminCredentials).Wait();
</code></pre></section>
</div>
<h4 id="querying-for-the-state-of-the-projection-by-partition">Querying for the state of the projection by partition</h4>
<p>Querying for the state of the projection is different due to the partitioning of the projection. You have to specify the partition and the name of the stream.</p>
<div class="tabGroup" id="tabgroup_-zRZHSVchy-12">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-12_tabid-read-partition-http" role="tab" aria-controls="tabpanel_-zRZHSVchy-12_tabid-read-partition-http" data-tab="tabid-read-partition-http" tabindex="0" aria-selected="true">HTTP API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-12_tabid-read-partition-dotnet" role="tab" aria-controls="tabpanel_-zRZHSVchy-12_tabid-read-partition-dotnet" data-tab="tabid-read-partition-dotnet" tabindex="-1">.NET API</a>
</li>
<li role="presentation">
<a href="#tabpanel_-zRZHSVchy-12_tabid-15" role="tab" aria-controls="tabpanel_-zRZHSVchy-12_tabid-15" data-tab="tabid-15" tabindex="-1">Response</a>
</li>
</ul>
<section id="tabpanel_-zRZHSVchy-12_tabid-read-partition-http" role="tabpanel" data-tab="tabid-read-partition-http">
<pre><code class="lang-bash" name="getting-started-projections-read-state-partition-request">curl -i http://localhost:2113/projection/shopping-cart-item-counter/state?partition=shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1164
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-12_tabid-read-partition-dotnet" role="tabpanel" data-tab="tabid-read-partition-dotnet" aria-hidden="true" hidden="hidden">
<pre><code class="lang-csharp" name="getting-started-projections-read-state-partition-request">var projectionState = projection.GetPartitionStateAsync(&quot;shopping-cart-item-counter&quot;, &quot;shoppingCart-b989fe21-9469-4017-8d71-9820b8dd1164&quot;, adminCredentials);
Console.WriteLine(projectionState.Result);
</code></pre></section>
<section id="tabpanel_-zRZHSVchy-12_tabid-15" role="tabpanel" data-tab="tabid-15" aria-hidden="true" hidden="hidden">
<pre><code class="lang-json" name="getting-started-projections-read-state-partition-response">{
    &quot;count&quot;: 2
}
</code></pre></section>
</div>
<h2 id="next-step">Next step</h2>
<p>In this third part of our getting started guide you learned about projections. The next, and final part covers which API or SDK to use, and when.</p>
<ul>
<li><a href="../which-api-sdk/index.html">Step 4 - Which API or SDK</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
            <div class="sinceversion">
            </div>
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/EventStore/documentation/blob/master/getting-started/projections.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer site-footer">
          <div class="container inner-container">
                      <p class="footer__copyright">&copy; 2019 Event Store Limited</p>
                      <ul class="footer__menu">
                          <li class="footer__menu__item"><a href="https://eventstore.org/">Home</a></li>
                          <li class="footer__menu__item"><a href="https://eventstore.org/about/">About Us</a></li>
                          <li class="footer__menu__item"><a href="https://eventstore.zendesk.com">Support Sign In</a></li>
                          <li class="footer__menu__item"><a href="https://eventstore.org/terms/">Terms</a></li>
                          <li class="footer__menu__item"><a href="https://eventstore.org/contact/">Contact</a></li>
                      </ul>
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
          </div>
        </div>
      </footer>
      <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
      <script src="https://eventstore.org/js/scripts.min.js"></script>    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
    
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-46209892-15"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-46209892-15');
        </script>  </body>
</html>
