{"conceptual":"\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"7\" sourceendlinenumber=\"7\">When you write to a stream you often want to use <code>Expected Version</code> to allow for optimistic concurrency with a stream. You commonly use this for a domain object projection.</p>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"9\" sourceendlinenumber=\"9\">i.e., &quot;A write can succeed if I have seen everyone else&#39;s writes.&quot;</p>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"11\" sourceendlinenumber=\"11\">You set <code>ExpectedVersion</code> with the syntax <code>ES-ExpectedVersion: #</code>, where <code>#</code> is an integer version number. There are other special values available:</p>\n<ul sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"13\" sourceendlinenumber=\"16\">\n<li sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"13\" sourceendlinenumber=\"13\"><code>0</code>, the stream should exist but be empty when writing.</li>\n<li sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"14\" sourceendlinenumber=\"14\"><code>-1</code>, the stream should not exist when writing.</li>\n<li sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"15\" sourceendlinenumber=\"15\"><code>-2</code>, the write should not conflict with anything and should always succeed.</li>\n<li sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"16\" sourceendlinenumber=\"16\"><code>-4</code>, the stream or a metadata stream should exist when writing.</li>\n</ul>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"18\" sourceendlinenumber=\"18\">If the <code>ExpectedVersion</code> does not match the version of the stream, Event Store returns an HTTP 400 <code>Wrong expected EventNumber</code> response. This response contains the current version of the stream in an <code>ES-CurrentVersion</code> header.</p>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"20\" sourceendlinenumber=\"20\">In the following cURL command <code>ExpectedVersion</code> is not set, and it appends or create/append to the stream.</p>\n<div class=\"tabGroup\" id=\"tabgroup_aBQ1I+q7tV\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"22\" sourceendlinenumber=\"30\">\n<ul role=\"tablist\">\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV_tabid-1\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV_tabid-1\" data-tab=\"tabid-1\" tabindex=\"0\" aria-selected=\"true\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"22\" sourceendlinenumber=\"22\">Request</a>\n</li>\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV_tabid-2\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV_tabid-2\" data-tab=\"tabid-2\" tabindex=\"-1\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"26\" sourceendlinenumber=\"26\">Response</a>\n</li>\n</ul>\n<section id=\"tabpanel_aBQ1I+q7tV_tabid-1\" role=\"tabpanel\" data-tab=\"tabid-1\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"24\" sourceendlinenumber=\"24\"><code class=\"lang-bash\" name=\"http-api-write-event-request\">curl -i -d &quot;@event.json&quot; &quot;http://127.0.0.1:2113/streams/newstream&quot; -H &quot;Content-Type:application/json&quot; -H &quot;ES-EventType: SomeEvent&quot; -H &quot;ES-EventId: C322E299-CB73-4B47-97C5-5054F920746E&quot;\n</code></pre></section>\n<section id=\"tabpanel_aBQ1I+q7tV_tabid-2\" role=\"tabpanel\" data-tab=\"tabid-2\" aria-hidden=\"true\" hidden=\"hidden\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"28\" sourceendlinenumber=\"28\"><code class=\"lang-json\" name=\"http-api-write-event-response\">HTTP/1.1 201 Created\nAccess-Control-Allow-Methods: POST, DELETE, GET, OPTIONS\nAccess-Control-Allow-Headers: Content-Type, X-Requested-With, X-PINGOTHER\nAccess-Control-Allow-Origin: *\nLocation: http://127.0.0.1:2113/streams/newstream/0\nContent-Type: text/plain; charset: utf-8\nServer: Mono-HTTPAPI/1.0\nDate: Fri, 28 Jun 2013 12:17:59 GMT\nContent-Length: 0\nKeep-Alive: timeout=15,max=100\n</code></pre></section>\n</div>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"32\" sourceendlinenumber=\"32\">The stream &#39;newstream&#39; has one event. If you append with an expected version of &#39;3&#39;, you receive an error.</p>\n<div class=\"tabGroup\" id=\"tabgroup_aBQ1I+q7tV-1\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"34\" sourceendlinenumber=\"42\">\n<ul role=\"tablist\">\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV-1_tabid-3\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV-1_tabid-3\" data-tab=\"tabid-3\" tabindex=\"0\" aria-selected=\"true\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"34\" sourceendlinenumber=\"34\">Request</a>\n</li>\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV-1_tabid-4\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV-1_tabid-4\" data-tab=\"tabid-4\" tabindex=\"-1\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"38\" sourceendlinenumber=\"38\">Response</a>\n</li>\n</ul>\n<section id=\"tabpanel_aBQ1I+q7tV-1_tabid-3\" role=\"tabpanel\" data-tab=\"tabid-3\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"36\" sourceendlinenumber=\"36\"><code class=\"lang-bash\" name=\"http-api-write-event-wrong-version-request\">curl -i -d @event-version.json &quot;http://127.0.0.1:2113/streams/newstream&quot; -H &quot;Content-Type:application/vnd.eventstore.events+json&quot; -H &quot;ES-ExpectedVersion: 3&quot;\n</code></pre></section>\n<section id=\"tabpanel_aBQ1I+q7tV-1_tabid-4\" role=\"tabpanel\" data-tab=\"tabid-4\" aria-hidden=\"true\" hidden=\"hidden\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"40\" sourceendlinenumber=\"40\"><code class=\"lang-json\" name=\"http-api-write-event-wrong-version-response\">HTTP/1.1 400 Wrong expected EventNumber\nAccess-Control-Allow-Methods: POST, DELETE, GET, OPTIONS\nAccess-Control-Allow-Headers: Content-Type, X-Requested-With, X-Forwarded-Host, X-Forwarded-Prefix, X-PINGOTHER, Authorization, ES-LongPoll, ES-ExpectedVersion, ES-EventId, ES-EventType, ES-RequiresMaster, ES-HardDelete, ES-ResolveLinkTos\nAccess-Control-Allow-Origin: *\nAccess-Control-Expose-Headers: Location, ES-Position, ES-CurrentVersion\nES-CurrentVersion: 0\nContent-Type: text/plain; charset=utf-8\nServer: Mono-HTTPAPI/1.0\nDate: Tue, 14 Aug 2018 14:08:44 GMT\nContent-Length: 0\nConnection: close\n</code></pre></section>\n</div>\n<p sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"44\" sourceendlinenumber=\"44\">You can see from the <code>ES-CurrentVersion</code> header above that the stream is at version 0. Appending with an expected version of 0 works. The expected version is always the version of the last event known in the stream.</p>\n<div class=\"tabGroup\" id=\"tabgroup_aBQ1I+q7tV-2\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"46\" sourceendlinenumber=\"54\">\n<ul role=\"tablist\">\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV-2_tabid-5\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV-2_tabid-5\" data-tab=\"tabid-5\" tabindex=\"0\" aria-selected=\"true\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"46\" sourceendlinenumber=\"46\">Request</a>\n</li>\n<li role=\"presentation\">\n<a href=\"#tabpanel_aBQ1I+q7tV-2_tabid-6\" role=\"tab\" aria-controls=\"tabpanel_aBQ1I+q7tV-2_tabid-6\" data-tab=\"tabid-6\" tabindex=\"-1\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"50\" sourceendlinenumber=\"50\">Response</a>\n</li>\n</ul>\n<section id=\"tabpanel_aBQ1I+q7tV-2_tabid-5\" role=\"tabpanel\" data-tab=\"tabid-5\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"48\" sourceendlinenumber=\"48\"><code class=\"lang-bash\" name=\"http-api-write-event-version-request\">curl -i -d @event-version.json &quot;http://127.0.0.1:2113/streams/newstream&quot; -H &quot;Content-Type:application/vnd.eventstore.events+json&quot; -H &quot;ES-CurrentVersion: 0&quot;\n</code></pre></section>\n<section id=\"tabpanel_aBQ1I+q7tV-2_tabid-6\" role=\"tabpanel\" data-tab=\"tabid-6\" aria-hidden=\"true\" hidden=\"hidden\">\n<pre sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"52\" sourceendlinenumber=\"52\"><code class=\"lang-json\" name=\"http-api-write-event-version-response\">HTTP/1.1 201 Created\nAccess-Control-Allow-Methods: POST, DELETE, GET, OPTIONS\nAccess-Control-Allow-Headers: Content-Type, X-Requested-With, X-Forwarded-Host, X-Forwarded-Prefix, X-PINGOTHER, Authorization, ES-LongPoll, ES-ExpectedVersion, ES-EventId, ES-EventType, ES-RequiresMaster, ES-HardDelete, ES-ResolveLinkTos\nAccess-Control-Allow-Origin: *\nAccess-Control-Expose-Headers: Location, ES-Position, ES-CurrentVersion\nLocation: http://127.0.0.1:2113/streams/newstream/2\nContent-Type: text/plain; charset=utf-8\nServer: Mono-HTTPAPI/1.0\nDate: Tue, 14 Aug 2018 10:02:08 GMT\nContent-Length: 0\nKeep-Alive: timeout=15,max=100\n</code></pre></section>\n</div>\n","type":"Conceptual","source":{"remote":{"path":"http-api/optional-http-headers/expected-version.md","branch":"feature/stats-REST","repo":"git@github.com:EventStore/docs.geteventstore.com.git"},"startLine":0.0,"endLine":0.0,"isExternal":false},"path":"http-api/optional-http-headers/expected-version.md","documentation":{"remote":{"path":"http-api/optional-http-headers/expected-version.md","branch":"feature/stats-REST","repo":"git@github.com:EventStore/docs.geteventstore.com.git"},"startLine":0.0,"endLine":0.0,"isExternal":false},"_docfxVersion":"2.43.3.0","_disableBreadcrumb":true,"_enableSearch":true,"_gitContribute":{"branch":"master"},"_appFaviconPath":"assets/favicon.ico","_appTitle":"Event Store","_appFooter":"&copy; 2019 Event Store Limited","_disableNavbar":false,"_disableToc":true,"_systemKeys":["conceptual","type","source","path","documentation","title","rawTitle","wordCount"],"title":"Optional HTTP Headers: Expected Version","rawTitle":"<h1 id=\"optional-http-headers-expected-version\" sourcefile=\"http-api/optional-http-headers/expected-version.md\" sourcestartlinenumber=\"5\" sourceendlinenumber=\"5\">Optional HTTP Headers: Expected Version</h1>","outputFileName":"index.html","wordCount":378.0,"_lang":"csharp","_tocPath":"toc.html","_navPath":"toc.html","_rel":"../../../","_path":"http-api/optional-http-headers/expected-version/index.html","_key":"http-api/optional-http-headers/expected-version.md","_navRel":"../../../toc.html","_tocRel":"../../../toc.html","_navKey":"~/toc.yml","_tocKey":"~/toc.yml","__global":{"classesInSubtitle":"Classes","structsInSubtitle":"Structs","interfacesInSubtitle":"Interfaces","enumsInSubtitle":"Enums","delegatesInSubtitle":"Delegates","constructorsInSubtitle":"Constructors","fieldsInSubtitle":"Fields","propertiesInSubtitle":"Properties","methodsInSubtitle":"Methods","eventsInSubtitle":"Events","operatorsInSubtitle":"Operators","eiisInSubtitle":"Explicit Interface Implementations","functionsInSubtitle":"Functions","membersInSubtitle":"Members","improveThisDoc":"Improve this Doc","viewSource":"View Source","inheritance":"Inheritance","inheritedMembers":"Inherited Members","namespace":"Namespace","assembly":"Assembly","syntax":"Syntax","overrides":"Overrides","implements":"Implements","remarks":"Remarks","examples":"Examples","seealso":"See Also","declaration":"Declaration","parameters":"Parameters","typeParameters":"Type Parameters","type":"Type","name":"Name","description":"Description","returns":"Returns","fieldValue":"Field Value","propertyValue":"Property Value","eventType":"Event Type","exceptions":"Exceptions","condition":"Condition","extensionMethods":"Extension Methods","note":"<h5>Note</h5>","warning":"<h5>Warning</h5>","tip":"<h5>Tip</h5>","important":"<h5>Important</h5>","caution":"<h5>Caution</h5>","next":"<h5>Next Steps</h5>","_shared":{}},"docurl":"https://github.com/EventStore/docs.geteventstore.com/blob/master/http-api/optional-http-headers/expected-version.md/#L1"}