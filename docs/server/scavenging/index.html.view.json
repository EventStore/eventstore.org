{"conceptual":"\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"8\" sourceendlinenumber=\"8\">When you delete events or streams in Event Store, they aren&#39;t removed immediately. To permanently delete these events you need to run a &#39;scavenge&#39; on your database.</p>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"10\" sourceendlinenumber=\"10\">A scavenge reclaims disk space by rewriting your database chunks, minus the events to delete, and then deleting the old chunks. Scavenges only affect completed chunks, so deleted events in the current chunk are still there after you run a scavenge.</p>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"12\" sourceendlinenumber=\"12\">After processing the chunks, the operation updates the chunk indexes using a merge sort algorithm, skipping events whose data is no longer available.</p>\n<div class=\"WARNING\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"14\" sourceendlinenumber=\"14\"><h5>Warning</h5><p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"15\" sourceendlinenumber=\"15\">Once a scavenge has run, you cannot recover any deleted events.</p>\n</div>\n<div class=\"NOTE\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"17\" sourceendlinenumber=\"17\"><h5>Note</h5><p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"18\" sourceendlinenumber=\"18\">Before version 4.0.2, a scavenge operation only worked with database chunk files. Since version 4.0.2 that reordering also happens inside the index files.</p>\n</div>\n<h2 id=\"starting-a-scavenge\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"20\" sourceendlinenumber=\"20\">Starting a scavenge</h2>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"22\" sourceendlinenumber=\"22\">Scavenges are not run automatically by Event Store. We recommendation that you set up a scheduled task, for example using cron or Windows Scheduler, to trigger a scavenge as often as you need.</p>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"24\" sourceendlinenumber=\"24\">You start a scavenge by issuing an empty <code>POST</code> request to the HTTP API with the credentials of an <code>admin</code> or <code>ops</code> user:</p>\n<div class=\"tabGroup\" id=\"tabgroup_anzGsTKshJ\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"26\" sourceendlinenumber=\"37\">\n<ul role=\"tablist\">\n<li role=\"presentation\">\n<a href=\"#tabpanel_anzGsTKshJ_tabid-8\" role=\"tab\" aria-controls=\"tabpanel_anzGsTKshJ_tabid-8\" data-tab=\"tabid-8\" tabindex=\"0\" aria-selected=\"true\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"26\" sourceendlinenumber=\"26\">Request</a>\n</li>\n<li role=\"presentation\">\n<a href=\"#tabpanel_anzGsTKshJ_tabid-9\" role=\"tab\" aria-controls=\"tabpanel_anzGsTKshJ_tabid-9\" data-tab=\"tabid-9\" tabindex=\"-1\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"33\" sourceendlinenumber=\"33\">Response</a>\n</li>\n</ul>\n<section id=\"tabpanel_anzGsTKshJ_tabid-8\" role=\"tabpanel\" data-tab=\"tabid-8\">\n<pre sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"28\" sourceendlinenumber=\"28\"><code class=\"lang-bash\" name=\"server-scavenge-request\">curl -i -d {} -X POST http://localhost:2113/admin/scavenge -u &quot;admin:changeit&quot;\n</code></pre><div class=\"NEXT\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"30\" sourceendlinenumber=\"30\"><h5>Next Steps</h5><p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"31\" sourceendlinenumber=\"31\">Scavenge operations have other options you can set to improve performance, <a href=\"#eventstore_org_HTTP_API_5_0_0_Scavenge_a_node\" data-raw-source=\"[read the API docs](#eventstore_org_HTTP_API_5_0_0_Scavenge_a_node)\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"31\" sourceendlinenumber=\"31\">read the API docs</a> for more details.</p>\n</div>\n</section>\n<section id=\"tabpanel_anzGsTKshJ_tabid-9\" role=\"tabpanel\" data-tab=\"tabid-9\" aria-hidden=\"true\" hidden=\"hidden\">\n<pre sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"35\" sourceendlinenumber=\"35\"><code class=\"lang-http\" name=\"server-scavenge-response\">HTTP/1.1 200 OK\nAccess-Control-Allow-Methods: POST, OPTIONS\nAccess-Control-Allow-Headers: Content-Type, X-Requested-With, X-Forwarded-Host, X-Forwarded-Prefix, X-PINGOTHER, Authorization, ES-LongPoll, ES-ExpectedVersion, ES-EventId, ES-EventType, ES-RequiresMaster, ES-HardDelete, ES-ResolveLinkTos\nAccess-Control-Allow-Origin: *\nAccess-Control-Expose-Headers: Location, ES-Position, ES-CurrentVersion\nContent-Type:\nServer: Mono-HTTPAPI/1.0\nDate: Wed, 19 Sep 2018 10:25:55 GMT\nContent-Length: 0\nKeep-Alive: timeout=15,max=100\n</code></pre></section>\n</div>\n<div class=\"NEXT\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"39\" sourceendlinenumber=\"39\"><h5>Next Steps</h5><p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"40\" sourceendlinenumber=\"40\">For better scavenge performance, you can set the number of threads to use. If you need to restart a stopped scavenge, you can specify the starting chunk ID. <a href=\"/http-api/swagger/Admin/Scavenge%20a%20node.html\" data-raw-source=\"[Find out more in the API reference](/http-api/swagger/Admin/Scavenge%20a%20node.html)\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"40\" sourceendlinenumber=\"40\">Find out more in the API reference</a>.</p>\n</div>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"42\" sourceendlinenumber=\"42\">You can also start scavenges from the <em>Admin</em> page of the Admin UI.</p>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"44\" sourceendlinenumber=\"44\"><img src=\"~/images/admin-scavenge.png\" alt=\"Start a scavenge in the Admin UI\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"44\" sourceendlinenumber=\"44\"></p>\n<div class=\"TIP\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"46\" sourceendlinenumber=\"46\"><h5>Tip</h5><p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"47\" sourceendlinenumber=\"47\">Each node in a cluster has its own independent database. As such, when you run a scavenge, you need to issue a scavenge request to each node.</p>\n</div>\n<h3 id=\"how-often-to-run-a-scavenge\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"49\" sourceendlinenumber=\"49\">How often to run a scavenge</h3>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"51\" sourceendlinenumber=\"51\">This depends on the following:</p>\n<ul sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"53\" sourceendlinenumber=\"54\">\n<li sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"53\" sourceendlinenumber=\"53\">How often you delete streams.</li>\n<li sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"54\" sourceendlinenumber=\"54\">Depending on how you set <code>$maxAge</code>, <code>$maxCount</code> or <code>$tb</code> metadata on your streams.</li>\n</ul>\n<h2 id=\"stopping-a-scavenge\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"56\" sourceendlinenumber=\"56\">Stopping a scavenge</h2>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"58\" sourceendlinenumber=\"58\">Stop a running scavenge operation by issuing a <code>DELETE</code> request to the HTTP API with the credentials of an <code>admin</code> or <code>ops</code> user and the ID of the scavenge you want to stop:</p>\n<pre sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"60\" sourceendlinenumber=\"62\"><code class=\"lang-bash\">curl -i -X DELETE http://localhost:2113/admin/scavenge/{scavengeId} -u &quot;admin:changeit&quot;\n</code></pre><p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"64\" sourceendlinenumber=\"64\">You can also stop scavenges from the <em>Admin</em> page of the Admin UI.</p>\n<div class=\"TIP\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"66\" sourceendlinenumber=\"66\"><h5>Tip</h5><p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"67\" sourceendlinenumber=\"67\">Each node in a cluster has its own independent database. As such, when you run a scavenge, you need to issue a scavenge request to each node.</p>\n</div>\n<h2 id=\"how-often-should-you-run-a-scavenge\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"69\" sourceendlinenumber=\"69\">How often should you run a scavenge</h2>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"71\" sourceendlinenumber=\"71\">This depends on the following:</p>\n<ul sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"73\" sourceendlinenumber=\"74\">\n<li sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"73\" sourceendlinenumber=\"73\">How often you delete streams.</li>\n<li sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"74\" sourceendlinenumber=\"74\">How you set <code>$maxAge</code>, <code>$maxCount</code> or <code>$tb</code> metadata on your streams.</li>\n</ul>\n<div class=\"TIP\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"76\" sourceendlinenumber=\"76\"><h5>Tip</h5><p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"77\" sourceendlinenumber=\"77\">Read the <a href=\"~/dotnet-api/stream-metadata.md\" data-raw-source=\"[.NET API](~/dotnet-api/stream-metadata.md)\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"77\" sourceendlinenumber=\"77\">.NET API</a> or <a href=\"~/http-api/stream-metadata.md\" data-raw-source=\"[HTTP API](~/http-api/stream-metadata.md)\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"77\" sourceendlinenumber=\"77\">HTTP API</a> docs for more details on setting metadata.</p>\n</div>\n<h2 id=\"scavenging-while-event-store-is-online\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"79\" sourceendlinenumber=\"79\">Scavenging while Event Store is online</h2>\n<p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"81\" sourceendlinenumber=\"81\">It&#39;s safe to run a scavenge while Event Store is running and processing events, as it&#39;s designed to be an online operation.</p>\n<div class=\"WARNING\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"83\" sourceendlinenumber=\"83\"><h5>Warning</h5><p sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"84\" sourceendlinenumber=\"84\">Scavenging increases the number of reads/writes made to disk, and it is not recommended when your system is under heavy load.</p>\n</div>\n","type":"Conceptual","source":{"remote":{"path":"server/scavenging.md","branch":"feature/stats-REST","repo":"git@github.com:EventStore/docs.geteventstore.com.git"},"startLine":0.0,"endLine":0.0,"isExternal":false},"path":"server/scavenging.md","documentation":{"remote":{"path":"server/scavenging.md","branch":"feature/stats-REST","repo":"git@github.com:EventStore/docs.geteventstore.com.git"},"startLine":0.0,"endLine":0.0,"isExternal":false},"_docfxVersion":"2.43.3.0","_disableBreadcrumb":true,"_enableSearch":true,"_gitContribute":{"branch":"master"},"_appFaviconPath":"assets/favicon.ico","_appTitle":"Event Store","_appFooter":"&copy; 2019 Event Store Limited","_disableNavbar":false,"_disableToc":true,"_systemKeys":["conceptual","type","source","path","documentation","title","rawTitle","wordCount"],"title":"Scavenging events","rawTitle":"<h1 id=\"scavenging-events\" sourcefile=\"server/scavenging.md\" sourcestartlinenumber=\"6\" sourceendlinenumber=\"6\">Scavenging events</h1>","outputFileName":"index.html","sinceVersion":"4.0.2","wordCount":541.0,"_lang":"csharp","_tocPath":"toc.html","_navPath":"toc.html","_rel":"../../","_path":"server/scavenging/index.html","_key":"server/scavenging.md","_navRel":"../../toc.html","_tocRel":"../../toc.html","_navKey":"~/toc.yml","_tocKey":"~/toc.yml","__global":{"classesInSubtitle":"Classes","structsInSubtitle":"Structs","interfacesInSubtitle":"Interfaces","enumsInSubtitle":"Enums","delegatesInSubtitle":"Delegates","constructorsInSubtitle":"Constructors","fieldsInSubtitle":"Fields","propertiesInSubtitle":"Properties","methodsInSubtitle":"Methods","eventsInSubtitle":"Events","operatorsInSubtitle":"Operators","eiisInSubtitle":"Explicit Interface Implementations","functionsInSubtitle":"Functions","membersInSubtitle":"Members","improveThisDoc":"Improve this Doc","viewSource":"View Source","inheritance":"Inheritance","inheritedMembers":"Inherited Members","namespace":"Namespace","assembly":"Assembly","syntax":"Syntax","overrides":"Overrides","implements":"Implements","remarks":"Remarks","examples":"Examples","seealso":"See Also","declaration":"Declaration","parameters":"Parameters","typeParameters":"Type Parameters","type":"Type","name":"Name","description":"Description","returns":"Returns","fieldValue":"Field Value","propertyValue":"Property Value","eventType":"Event Type","exceptions":"Exceptions","condition":"Condition","extensionMethods":"Extension Methods","note":"<h5>Note</h5>","warning":"<h5>Warning</h5>","tip":"<h5>Tip</h5>","important":"<h5>Important</h5>","caution":"<h5>Caution</h5>","next":"<h5>Next Steps</h5>","_shared":{}},"docurl":"https://github.com/EventStore/docs.geteventstore.com/blob/master/server/scavenging.md/#L1"}